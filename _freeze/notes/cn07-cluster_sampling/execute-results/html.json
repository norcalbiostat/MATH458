{
  "hash": "7892ca2c3ad0329abacb4673817afa82",
  "result": {
    "markdown": "---\ntitle: \"Cluster Sampling\"\ndescription: \"Selecting groups at . Lohr Ch 5. \"\nauthor: DRAFT - 458 class\ndate: 3/20/23\nexecute: \n  error: true\n  warning: false\n  message: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here); library(tidyverse);library(knitr)\nlibrary(sampling); library(survey)\n```\n:::\n\n\n# Introduction\n\nLet’s say we want to find the number of bicycles owned within a community of 10,000 households. We have several options for picking a sample:\n\n- Obtaining a SRS of 400 households\n- Stratifying households into groups then choosing a SRS from these groups \n- Separate the population into blocks of 500 and then randomly select 20 of these blocks and survey every household that is part of the blocks chosen\n\n This last option is an example of **cluster sampling**. In cluster sampling, we have **primary sampling units**(psus), or clusters, which are represented by the blocks. We also have **secondary sampling units**(ssus) which are the households within the blocks. In an SRS, the units sampled are the observed elements, but in a cluster sample, the sampling units are our clusters. In a cluster sample, our universe is the population $N$ clusters. \n\nCluster of 400 households vs SRS of 400 households?\n\n- The cluster sample would result in less precision because of our blocks. Some might be composed of mainly families(who are more likely to have bikes) while others are mainly older people.\n- In this case, clusters won’t be as representative of the population as a SRS would. \n- Can be cheaper and faster than other sampling methods\n\n# Notation & Formulas\n\n::: panel-tabset\n## Pop psu level\n\n| Symbol      | Formula                                                          | Description                                    |\n|------------|--------------------------|----------------------------------------|\n| $y_{ij}$    |                                                                  | measurement for the $j$th element in $i$th psu |\n| $N$         |                                                                  | number of clusters (psus) in the population    |\n| $M_{i}$     |                                                                  | number of ssus in psu $i$                      |\n| $M_{0}$     | $\\sum_{i=1}^{N} M_{i}$                                           | total number of ssus in the population         |\n| $t_{i}$     | $\\sum_{j=1}^{M_{i}} y_{ij}$                                      | total in psu $i$                               |\n| $t$         | $\\sum_{i=1}^{N} t_{i}= \\sum_{i=1}^{N} \\sum_{j=1}^{M_{i}} y_{ij}$ | population total                               |\n| $S_{t}^{2}$ | $\\frac{1}{N-1} \\sum_{i=1}^{N} (t_{i} - \\frac{t}{N})^2$           | population variance of the psu totals          |\n\n## Pop ssu level\n\n| Symbol           | Formula                                                                  | Description                        |\n|-------------------|-----------------------------------|-------------------|\n| $\\bar{y}_{\\mu}$  | $\\frac{1}{M_0} \\sum_{i=1}^N \\sum_{j=1}^{M_i} y_{ij}$                     | population mean                    |\n| $\\bar{y}_{i\\mu}$ | $\\frac{1}{M_i} \\sum_{j=1}^{M_i} y_{ij} = \\frac{t_i}{M_i}$                | population mean in psu $i$         |\n| $S^2$            | $\\frac{1}{M_0-1} \\sum_{i=1}^N \\sum_{j=1}^{M_i} (y_{ij}-\\bar{y}_{\\mu})^2$ | population variance (per ssu)      |\n| $S_{i}^{2}$      | $\\frac{1}{M_i-1} \\sum_{j=1}^{M_i} (y_{ij}-\\bar{y}_{\\mu})^2$              | population variance within psu $i$ |\n\n## Sample\n| Symbol                   | Formula                                                  | Description                                     |\n|------------------|-----------------------------|-----------------------------|\n| $y_{ij}$ |                                                                |Measurement for$j$th element in $i$ht psu                                             |\n|$N$||Number of clusters (psus) in the population|\n|$M_i$||Number of ssus in psu $i$|\n|$M_{o}$|$\\sum_{i=1}^NM_i$|Total number of psus in the popultion|\n|$t_i$|$\\sum_{j=1}^{M_i}y_{ij}$|Total in psu $i$|\n|$t$|$\\sum_{i=1}^Nt_i = \\sum_{i=1}^N\\sum_{j=i}^{M_i}y_{ij}$|Popultion Total|\n|$S_i^2$|$\\frac{1}{N-1} \\sum_{i=1}^N(t_i-\\frac{t}{N})^2$|Popultion variance of the psu totals|\n\n:::\n\n\n\n## Why use Cluster Sampling?\n\n-   Constructing a sample frame list may be expensive, difficult, or impossible.\n    -   Making a sampling frame of all honeybees in a region would be impossible-you cannot enumerate them, or even be sure how many there are (N)\n    -   Making a sampling frame of all trees in a region is possible, however it may be extremely time consuming, and therefore expensive.\n-   The population may be widely distributed geographically or appear in natural clusters.\n    -   Households or schools can appear in natural clusters\n    -   If your target population is nursing home residents in the US, it would be very hard to take an SRS of all nursing home residents, and then travel to each one individually. Taking a cluster sample of a few nursing homes and then taking observations from everyone in them would be less expensive and time consuming.\n\n:::{.callout-note icon=false}\nA cluster is similar to a stratum because it is grouping members of the population.\n\nHowever, cluster sampling reduces precision compared to SRS whereas precision is increased with a stratified sample. \n:::\n\nThis is because members of the same cluster tend to be very similar, and sampling everyone in the cluster results in the same information being repeated rather than learning new information.\n\nMost large surveys usually use cluster sampling, most likely because of the low costs and convenience compared to other sampling methods\n\nTo increase the precision of the clusters, survey conductors could group the population primary sampling units (the clusters) into stratas and select a probability sample of psus within each stratum. \n\n## When clusters are Ignored\n\nDo not analyze cluster samples like you would analyze an SRS. Doing so can lead to statistics from the survey appearing more precise than they actually are.\n\n:::success\n### Studies in education\n\nDue to the natural clustering of students within a classroom, educational studies often involve cluster sampling. \n\nConsider a study where a school (the population) is stratified by classroom. 32 professors (16 male and 16 female) were selected based on the subject they taught, years of experience, and tenure status. In this example, the classrooms are the clusters.\n:::\n\nQuestionnaires went out to all students in each of the selected classrooms. The researchers wanted to see if students evaluated male and female professors differently.\n\n* The sample size in this study is $n = 32$, the number of faculty studied\n    * Note this is **not** the total number of students who returned the questionnaire.\n* Because the students in each classroom are likely to have some agreement in the rating they assign to their professor, they can not be treated as independent.\n    * If the students are treated as independent, the variance from the sample will be _smaller_ than the real value and differences between clusters will be declared statistically significant more often than they should be.\n\n\n------------------------------------------------------------------------\n\n# One-Stage Clustering Sampling\n\n## Equal size clusters\n\n-   Each *psu* has the same number of elements; $M_{i} = m_{i} = M$.\n-   Often can be found in agriculture or industrial sampling.\n-   $t_{i}$ is the total for all elements in *psu* $i$.\n-   $t_{i}$ is known for sampled households, since data is collected on both individuals. (E.g. $Var(t_{i})=0$)\n\n:arrow_right: Treat the *psu* means or totals as observations, and ignore the individual elements. We now have an SRS of $n$ data points.\n\nThus we can use the same SRS formulas to estimate the total and mean, **however** this is an SRS of $n$ *psu*'s, not an SRS of $nM$ observational units. So the $df$ needed to create a Confidence Interval is $n-1$.\n\nTo estimate the population total $t$ or average $\\mu$, we can use the following estimators and variances:\n\n$$\n\\hat{t} = \\frac{N}{n}\\sum_{i \\in S}t_{i} \\qquad \ns_{t}^{2} = \\frac{1}{n-1}\\sum_{i \\in S}\\Big(t_{i} - \\frac{\\hat{t}}{N}\\Big)^2\n$$\n\nand \n$$\n\\hat{\\bar{y}} = \\frac{\\hat{t}}{NM} \\qquad\nV(\\hat{\\bar{y}}) = \\Big(1-\\frac{n}{N}\\Big)\\frac{s^{2}_t}{nM^2}\n$$\n\n::: {.callout-tip icon=\"true\"}\n### Estimate the income in a two person households\n\nConsider individual incomes ($y_{ij}$) for each of $j=1,2$ persons in the 3 sampled households out of the 50 in the population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhhi <- data.frame(\n  household = c(1:3), \n  yi1 = c(37638, 69012, 30001), \n  yi2 = c(79999, 86753, 54321)\n)\nkable(hhi, align = 'c')\n```\n\n::: {.cell-output-display}\n| household |  yi1  |  yi2  |\n|:---------:|:-----:|:-----:|\n|     1     | 37638 | 79999 |\n|     2     | 69012 | 86753 |\n|     3     | 30001 | 54321 |\n:::\n:::\n\n:::\n\nFirst define our known values: N = 50, n = 3, M = 2.\n\nThe total household income $t_i$ is calculated as the sum of the individual incomes within each cluster $\\sum_j y_{ij}$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhhi$ti <- hhi$yi1 + hhi$yi2\nhhi\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  household   yi1   yi2     ti\n1         1 37638 79999 117637\n2         2 69012 86753 155765\n3         3 30001 54321  84322\n```\n:::\n:::\n\n\nThe estimated mean is\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt.hat <- (50/3)*sum(hhi$ti)\n(ybar.hat <- t.hat / (50*2))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 59620.67\n```\n:::\n:::\n\n\nwith variance\n\n\n::: {.cell}\n\n```{.r .cell-code}\ns2.t <- (1/(3-1))*sum((hhi$ti - t.hat/50)^2)\n(var.ybar.hat <- (1 - 3/50)*(s2.t/(3*2^2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 100106551\n```\n:::\n:::\n\n\nCalculate CI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrit.t <- qt(.975, 3-1)\nci.low.mu  <- ybar.hat - crit.t*sqrt(var.ybar.hat)\nci.hi.mu   <- ybar.hat + crit.t*sqrt(var.ybar.hat)\n```\n:::\n\n\nWe can be 95% confident that the average population income for a household of two people is contained in the interval ($16,571, $102,670.\n\n::: {.callout-warning icon=\"false\"}\n### :star: You try it: Average GPA in a dorm\n\nA student wants to estimate the average GPA in their dorm. Obtaining a listing of all students in the hall and conducting an SRS would take a lot of time. Instead, since each of the 100 suites in the hall have 4 students, the student randomly samples 5 suites and collects GPA data for each student in the suite.\n\nUsing functions from the `sampling` package, estimate the average GPA for all students living in that dorm, with a proper 95% CI. Interpret your interval.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngpa <- readr::read_csv(here::here(\"data\", \"gpa.csv\"))\nhead(gpa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  suite   gpa    wt\n  <dbl> <dbl> <dbl>\n1     1  3.08    20\n2     1  2.6     20\n3     1  3.44    20\n4     1  3.04    20\n5     2  2.36    20\n6     2  3.04    20\n```\n:::\n:::\n\n\nThe data was recorded in long format -- this is the format needed for analysis. The table in the book is formatted for human eyeball consumption, not for analysis.\n:::\n\n1.  Set the survey design.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngpa.design <- svydesign(id = ~suite,\n                        weights = ~wt,\n                        fpc=~rep(100,20),\n                        data=gpa) \n```\n:::\n\n\n2.  Call `surveymean` and CI.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(dorm.gpa.mean <- svymean(~gpa, gpa.design))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     mean     SE\ngpa 2.826 0.1637\n```\n:::\n\n```{.r .cell-code}\n(df <- degf(gpa.design)) # Extract degrees of freedom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4\n```\n:::\n\n```{.r .cell-code}\nconfint(dorm.gpa.mean, level=.95, df=4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       2.5 %   97.5 %\ngpa 2.371593 3.280407\n```\n:::\n:::\n\n\nWe can be 95% confident that the average GPA for students living in this dorm is contained in the interval 2.37 to 3.28.\n\n\n------------------------------------------------------------------------\n\n# Two-Stage Clustering Sampling\n\n\n# One Stage vs Two Stage Clustering\n\n### One Stage Clustering\n\n* All you do is carry out an SRS on all available PSUs from your population of $N$ PSUs.  Then subsequently establish a census.\n* This provides us the variance across clusters\n\n### Two Stage Clustering\n\n* In two stage clustering the only additional step is to take an SRS of size $m_i$ within each already sample $i$th PSU.\n* This finds the variance within clusters\n\n#### Unbiased Estimate for $t$\n\n$$t=w_{ij}\\sum y_{ij}=\\sum\\frac{NM_i}{nm_i}y_{ij}$$\n\nNote: The same formula is applicable to both one and two stage clustering because, if you think about it, one stage clustering is just a special case of two stage clustering.  That being the case where $M_i=m_i$.\n\n\n\n------------------------------------------------------------------------\n\n# Systematic Sampling\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}