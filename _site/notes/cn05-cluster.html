<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.319">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="DRAFT">
<meta name="dcterms.date" content="2025-04-01">
<meta name="description" content="When units are not necessarily nicely defined, even when the population is.">

<title>Sampling Methods - Cluster Sampling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sampling Methods</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../notes.html" rel="" target="">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments.html" rel="" target="">
 <span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../project.html" rel="" target="">
 <span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hackmd-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">HackMD Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hackmd-notes">    
        <li>
    <a class="dropdown-item" href="https://hackmd.io/@norcalbiostat/458_intro_hackmd" rel="" target="">
 <span class="dropdown-text">What is HackMD</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hackmd.io/@norcalbiostat/cn01-intro_sampling" rel="" target="">
 <span class="dropdown-text">Ch 1. Sampling Framework</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hackmd.io/@norcalbiostat/cn02-statistical_foundations" rel="" target="">
 <span class="dropdown-text">Ch 2. Foundations of Estimation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hackmd.io/@norcalbiostat/cn04_stratified" rel="" target="">
 <span class="dropdown-text">Ch 3. Stratified Sampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hackmd.io/@norcalbiostat/cn05_cluster" rel="" target="">
 <span class="dropdown-text">Ch 5. Cluster Sampling</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-google" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-google" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-google">    
        <li>
    <a class="dropdown-item" href="https://docs.google.com/spreadsheets/d/1Inj6xmMsoRcIHR5mpVShQisg5llXwesoDRuVRbvI5mY" rel="" target="">
 <span class="dropdown-text">Content creation group</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.google.com/spreadsheets/d/1f4ze0905zE4HbtEyqVrJv1ncMB4EdNZDd4QJH5wewS0" rel="" target="">
 <span class="dropdown-text">Sechedule</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://drive.google.com/drive/folders/13YG6_6exekRfJr2NngUCO465UosodQGA" rel="" target="">
 <span class="dropdown-text">Project folder</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../formulas.html" rel="" target="">
 <span class="menu-text">Formulas and Definitions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#example-of-clustering" id="toc-example-of-clustering" class="nav-link" data-scroll-target="#example-of-clustering">Example of Clustering:</a></li>
  <li><a href="#why-use-cluster-sampling" id="toc-why-use-cluster-sampling" class="nav-link" data-scroll-target="#why-use-cluster-sampling">Why use Cluster Sampling?</a></li>
  <li><a href="#when-clusters-are-ignored" id="toc-when-clusters-are-ignored" class="nav-link" data-scroll-target="#when-clusters-are-ignored">When clusters are Ignored</a></li>
  </ul></li>
  <li><a href="#notation-formulas" id="toc-notation-formulas" class="nav-link" data-scroll-target="#notation-formulas">Notation &amp; Formulas</a></li>
  <li><a href="#one-stage-clustering-sampling" id="toc-one-stage-clustering-sampling" class="nav-link" data-scroll-target="#one-stage-clustering-sampling">One-Stage Clustering Sampling</a>
  <ul class="collapse">
  <li><a href="#equal-size-clusters-estimation" id="toc-equal-size-clusters-estimation" class="nav-link" data-scroll-target="#equal-size-clusters-estimation">Equal size clusters: Estimation</a>
  <ul class="collapse">
  <li><a href="#sampling-weights" id="toc-sampling-weights" class="nav-link" data-scroll-target="#sampling-weights">Sampling Weights</a></li>
  </ul></li>
  <li><a href="#equal-size-clusters-theory" id="toc-equal-size-clusters-theory" class="nav-link" data-scroll-target="#equal-size-clusters-theory">Equal size clusters: Theory</a>
  <ul class="collapse">
  <li><a href="#comparing-a-cluster-sample-with-an-srs-of-the-same-size" id="toc-comparing-a-cluster-sample-with-an-srs-of-the-same-size" class="nav-link" data-scroll-target="#comparing-a-cluster-sample-with-an-srs-of-the-same-size">Comparing a cluster sample with an SRS of the same size</a></li>
  </ul></li>
  <li><a href="#unequal-size-clusters" id="toc-unequal-size-clusters" class="nav-link" data-scroll-target="#unequal-size-clusters">Unequal size clusters</a>
  <ul class="collapse">
  <li><a href="#ratio-estimation" id="toc-ratio-estimation" class="nav-link" data-scroll-target="#ratio-estimation">Ratio Estimation</a></li>
  <li><a href="#estimation-using-weights" id="toc-estimation-using-weights" class="nav-link" data-scroll-target="#estimation-using-weights">Estimation using weights</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#two-stage-clustering-sampling" id="toc-two-stage-clustering-sampling" class="nav-link" data-scroll-target="#two-stage-clustering-sampling">Two-Stage Clustering Sampling</a>
  <ul class="collapse">
  <li><a href="#unbiased-estimator-of-population-total." id="toc-unbiased-estimator-of-population-total." class="nav-link" data-scroll-target="#unbiased-estimator-of-population-total.">Unbiased estimator of population total.</a></li>
  <li><a href="#survey-weights" id="toc-survey-weights" class="nav-link" data-scroll-target="#survey-weights">Survey weights</a></li>
  <li><a href="#variance-estimation-for-two-stage-cluster-samples." id="toc-variance-estimation-for-two-stage-cluster-samples." class="nav-link" data-scroll-target="#variance-estimation-for-two-stage-cluster-samples.">Variance estimation for two-stage cluster samples.</a>
  <ul class="collapse">
  <li><a href="#simplified-version" id="toc-simplified-version" class="nav-link" data-scroll-target="#simplified-version">Simplified version</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary">Chapter Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cluster Sampling</h1>
</div>

<div>
  <div class="description">
    When units are not necessarily nicely defined, even when the population is.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>DRAFT </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse);<span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling); <span class="fu">library</span>(survey)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sampling Units
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>psu</strong> or <strong>psus</strong> (plural) is the shortening of the term, primary sampling unit(s). These are the sampling units in a cluster sample. An alternate term is <strong>cluster</strong>.</p>
<p>A <strong>ssu</strong> or <strong>ssus</strong> (plural) is the shortening of the term, secondary sampling unit(s). These are the observation units observed within our clusters.</p>
</div>
</div>
<section id="example-of-clustering" class="level3">
<h3 class="anchored" data-anchor-id="example-of-clustering">Example of Clustering:</h3>
<p>When taking a survey of a community, rather than do an SRS of households, you might break up the community into blocks and take an SRS of blocks and sample all or some of the households that fall within those blocks. The blocks are your psus, and the households are your ssus. This method might be less costly if you were doing an in person survey, but might also be less accurate.</p>
</section>
<section id="why-use-cluster-sampling" class="level2">
<h2 class="anchored" data-anchor-id="why-use-cluster-sampling">Why use Cluster Sampling?</h2>
<p>Clustering is most common for its application.The purpose of stratifying a sample before was to better your prediction or accuracy when the variance varied quite differently among the population. It is not quite the same for Cluster Sampling, for it actually decreases in precision due to some positive correlation between unmeasurable factors that effect certain specific clusters.</p>
<p>We use Cluster Sampling when: 1. It may be unfeasible or expensive to construct a sampling frame of the population, and breaking into groups may make sampling doable. 2. In some populations, it’s less costly to sample in clusters, in terms of travel and time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../figs/fig5_1.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Textbook Figure 5.1. Contrasting stratified sampling with one-stage cluster sampling.</figcaption><p></p>
</figure>
</div>
</section>
<section id="when-clusters-are-ignored" class="level2">
<h2 class="anchored" data-anchor-id="when-clusters-are-ignored">When clusters are Ignored</h2>
<p>When clusters are ignored in the design or analysis phase, the sample can mistakenly be treated as if it were using the simple random sampling design. When they are ignored they can lead to incorrect formulas that have inaccurate conclusions. For example, when we analyze our sample as an SRS the variability can be underestimated on account of the clusters being designed to be more similar and homogeneous compared to an SRS and stratified sample. This will lead to values that are too small and confidence intervals that can be too narrow.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Studies in education
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many studies in education (either involving teachers, students, other faculty, etc.) use cluster sampling for data collection. Clusters can include entire schools or even just individual classrooms. This is much more cost effective and logistically simpler than taking an SRS of individuals (students, staff, etc.).</p>
<p>One known example [conducted by Basow and Silberg (1987) and Basow and Martin (2012)] examined whether students rated professors differently based on gender (female vs male professors).</p>
</div>
</div>
<ul>
<li>In this study they took 16 female and 16 male professors and matched them by their subjects, experience, and tenure status.</li>
<li>They then sampled each of their classrooms full of students for data collection.</li>
<li>They, in total, collected 1029 individual student responses but since we are using cluster sampling the sample size will be n = 32 as there are 32 total clusters. The analysis would be wrong if we ignored that it was a cluster sample and treated it as an SRS of size 1029.</li>
</ul>
<p>This is a great real world example of how cluster sampling can streamline collecting important data while still gaining valuable insight.</p>
</section>
</section>
<section id="notation-formulas" class="level1">
<h1>Notation &amp; Formulas</h1>
<p>In SRS, each individual element is the sampling unit, and has an equal chance to be sampled. In stratified sampling, the population is divided into <span class="math inline">\(H\)</span> known strata, and a sample is taken from each. Our sampling unit in the cluster design is the entire cluster, or primary sampling unit <span class="math inline">\(psus\)</span>, and not the individual elements.</p>
<p>In stratified sampling we have our entire population being <span class="math inline">\(N\)</span> total population of each individual element, whereas our entire universe in cluster sampling is the number of clusters, that is <span class="math inline">\(N\)</span> is the number of <span class="math inline">\(psus\)</span>.</p>
<p>⚠️ Note notation change!</p>
<ul>
<li><span class="math inline">\(y_{ij}\)</span>: measurement for the <span class="math inline">\(j\)</span>th element in <span class="math inline">\(i\)</span>th psu</li>
<li><span class="math inline">\(N\)</span>: the number of clusters (psus) in the population
<ul>
<li><span class="math inline">\(n\)</span>: the number of psus from the sample</li>
</ul></li>
<li><span class="math inline">\(M_{i}\)</span>: number of ssus in psu <span class="math inline">\(i\)</span> in the population
<ul>
<li><span class="math inline">\(m_i\)</span>: the number of ssu’s in psu <span class="math inline">\(i\)</span> from the sample</li>
</ul></li>
<li><span class="math inline">\(M_{0}\)</span>: total number of ssus in the population</li>
</ul>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 30%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Population Quantity</th>
<th>Estimator <span class="math inline">\((\hat{\theta})\)</span></th>
<th>Estimated variance of <span class="math inline">\((\hat{\theta})\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Total in psu <span class="math inline">\(i\)</span>: <span class="math inline">\(t_{i}=\sum_{j} y_{ij}\)</span></td>
<td><span class="math inline">\(\hat{t}_{i} = \frac{M_{i}}{m_i}\sum_{j} y_{ij}\)</span></td>
<td>-</td>
</tr>
<tr class="even">
<td>Variance of psu totals : <span class="math inline">\(S_t^2 = \frac{1}{N-1} \sum_{i} \left( t_i - \frac{t}{N} \right)^2\)</span></td>
<td><span class="math inline">\(s_t^2 = \frac{1}{n-1} \sum_{i} \left( t_i - \frac{\hat{t}}{N} \right)^2\)</span></td>
<td><em>AKA variance between psu</em></td>
</tr>
<tr class="odd">
<td>Overall Total: <span class="math inline">\(t = \sum_{i} t_i\)</span></td>
<td><span class="math inline">\(\hat{t} = \frac{N}{n}\sum_{i} \hat{t}_i\)</span></td>
<td><span class="math inline">\(N^2 \left(1 - \frac{n}{N}\right) \frac{s_t^2}{n}\)</span></td>
</tr>
<tr class="even">
<td>mean in psu <span class="math inline">\(i\)</span>: <span class="math inline">\(\mu_{i} = \frac{1}{M_i} \sum_{j} y_{ij}\)</span></td>
<td><span class="math inline">\(\bar{y}_{i} = \frac{1}{m_i} \sum_{j} y_{ij}\)</span></td>
<td><span class="math inline">\(s_{i}^{2} = \frac{1}{m_i-1} \sum_{j} (y_{ij}-\bar{y}_{i})^2\)</span> (<em>AKA variance within psu</em>)</td>
</tr>
<tr class="odd">
<td>Overall mean: <span class="math inline">\(\mu = \frac{1}{M_0} \sum_{i} \sum_{j} y_{ij}\)</span></td>
<td><span class="math inline">\(\bar{y} = \frac{\hat{t}}{NM}\)</span></td>
<td><span class="math inline">\(\left( 1 - \frac{n}{N} \right) \frac{s_t^2}{nM^2}\)</span></td>
</tr>
</tbody>
</table>
<p>Overall there are many differences between clustering, stratification, and SRS, that are important to note.</p>
<hr>
</section>
<section id="one-stage-clustering-sampling" class="level1">
<h1>One-Stage Clustering Sampling</h1>
<section id="equal-size-clusters-estimation" class="level2">
<h2 class="anchored" data-anchor-id="equal-size-clusters-estimation">Equal size clusters: Estimation</h2>
<p>One-stage clustering is the type of clustering you’re probably already familiar with - either all (or none) of the observations inside of a cluster (psu) are sampled.</p>
<p>While this is an unrealistic scenario for most statistical work in the social sciences, agricultural or industrial surveys may be able to take advantage of the much simpler process that equal size clustering brings.</p>
<p>Because the psus are selected through an SRS, we can use the per-cluster estimates as single observations in an SRS. There’s no need to consider the individual ssus within each cluster. <strong>Important distinction: we treat this as an SRS of <span class="math inline">\(n\)</span> psus, not an SRS of <span class="math inline">\(nM\)</span> observational units.</strong></p>
<p>In this setup, we typically aim to estimate the population total or mean of a variable of interest based on the totals from each sampled cluster.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example: Average GPA in a dorm
</div>
</div>
<div class="callout-body-container callout-body">
<p>Perhaps we want to estimate the average GPA in a college dormitory with a one-stage cluster design. The dorm consists of 100 units, each with 4 students. Here’s the process:</p>
<ol type="1">
<li>An SRS is conducted to select 5 clusters.<br>
</li>
<li>All 4 students (ssus) per dormitory unit (psus) have their GPAs measured</li>
<li>Calculate your estimates based on your <em>psu</em> statistics, not your ssu measurements.</li>
</ol>
<p><em>(Slightly modified version of Example 5.2 from Lohr’s R Companion to Sampling 3rd ed.&nbsp;Page 57. DOI: 10.1201/9781003228196-5)</em></p>
</div>
</div>
<section id="using-the-survey-package" class="level4">
<h4 class="anchored" data-anchor-id="using-the-survey-package">Using the <code>survey</code> package</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>gpa <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"gpa.csv"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># total dorm population (this won't be NROW(gpa)!)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5</span>   <span class="co"># total number of clusters/psus selected</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">4</span>   <span class="co"># observational units/ssus selected per psu</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a survey design for one-stage clustering</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>OSC_gpa <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id =</span> <span class="sc">~</span>suite,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="sc">~</span>wt,<span class="co">#already on the data set</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fpc =</span> <span class="sc">~</span><span class="fu">rep</span>(<span class="dv">100</span>,<span class="dv">20</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> gpa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>calculate the mean GPA and 95% confidence interval using survey package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(mean_gpa <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span>gpa, OSC_gpa))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mean     SE
gpa 2.826 0.1637</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(mean_gpa_confint <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span>gpa, OSC_gpa) <span class="sc">|&gt;</span> <span class="fu">confint</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       2.5 %   97.5 %
gpa 2.505223 3.146777</code></pre>
</div>
</div>
<p>The point estimate for GPA is 2.83, with a 95% confidence interval of 2.51 to 3.15.</p>
</section>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section"></h4>
</section>
<section id="sampling-weights" class="level3">
<h3 class="anchored" data-anchor-id="sampling-weights">Sampling Weights</h3>
<p>In one-stage cluster sampling with equal-sized clusters, each cluster is treated as a single observation. The sampling weight for each observation unit <span class="math inline">\(j\)</span> in PSU <span class="math inline">\(i\)</span> is based on the inverse probability of that PSU being selected. This results in a <strong>self-weighting sample</strong>, meaning every sampled element gets the same weight.</p>
<p><span class="math display">\[
w_{ij} = \frac{N}{n}
\]</span></p>
<p>The total sampling weight across all sampled units equals the total number of units in the population (<span class="math inline">\(NM\)</span>). Make sure to always verify that the sum of your weights matches the population size. Population total and mean can also be estimated using these weights by summing the weighted values or averaging them appropriately.</p>
<p>This weighting approach allows you to use one-stage cluster sampling estimates similarly to how you’d handle stratified or SRS data, despite the cluster structure.</p>
<hr>
</section>
</section>
<section id="equal-size-clusters-theory" class="level2">
<h2 class="anchored" data-anchor-id="equal-size-clusters-theory">Equal size clusters: Theory</h2>
<section id="comparing-a-cluster-sample-with-an-srs-of-the-same-size" class="level3">
<h3 class="anchored" data-anchor-id="comparing-a-cluster-sample-with-an-srs-of-the-same-size">Comparing a cluster sample with an SRS of the same size</h3>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ANalysis Of VAriance
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t recall how ANOVA works to break up the variance into components? See <a href="https://www.youtube.com/watch?v=W36DMVJ4Ibo&amp;list=PLkIselvEzpM5G3IO1tzQ-DUThsJKQzQCD">this great video</a> from the Open Intro Statistics author, Mine Cetinkaya-Rundel</p>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
MSB (Mean Squared Between psus)
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
MSW (Mean Squared Within psus)
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ICC (Intraclass Correlation Coefficient)
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
R Squared
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 5.3. Consider two artificial populations
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 5.5. When is a cluster not a cluster?
</div>
</div>
<div class="callout-body-container callout-body">
<p>text</p>
</div>
</div>
</section>
</section>
<section id="unequal-size-clusters" class="level2">
<h2 class="anchored" data-anchor-id="unequal-size-clusters">Unequal size clusters</h2>
<blockquote class="blockquote">
<p>advice: summarize motivating example. Explain unbiasedness and show formulas. Then bullet point rest of section</p>
</blockquote>
<section id="ratio-estimation" class="level3">
<h3 class="anchored" data-anchor-id="ratio-estimation">Ratio Estimation</h3>
</section>
<section id="estimation-using-weights" class="level3">
<h3 class="anchored" data-anchor-id="estimation-using-weights">Estimation using weights</h3>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example. High school Algebra
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider a population of 187 high school algebra classes in a city. An investigator takes an SRS of classes, and gives each student in the sampled classes a test about function knowledge. The (hypothetical) data are given in the file <code>algebra.csv</code>.</p>
<ol type="a">
<li>Load in the data and look at the first few rows. Explain what the values in each column mean.</li>
<li>Plot the distribution of test score by class. Interpret your graph by comparing the medians, ranges, and variances across classes. What do you notice?</li>
<li>How many <em>psus</em> are there? What is the <em>psu</em> with the highest number of <em>ssus</em>? Which one has the least? You must answer this question using R functions such as<code>unique</code> or <code>table</code>. Don’t count this by hand (practice for when you have a billion rows)</li>
<li>Add variables containing the weights and the <code>fpc</code> to this data set.</li>
<li>Using the proper functions from the <code>survey</code> package, estimate the population average algebra score, with a 95% interval and interpret your interval. Be sure to NOT assume a Z-distribution for this confidence interval but use the <code>degf</code> function to get the proper degrees of freedom out of the survey design object and pass it to the <code>confint</code> function.</li>
</ol>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="two-stage-clustering-sampling" class="level1">
<h1>Two-Stage Clustering Sampling</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../figs/fig5_2.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Textbook Figure 5.2. Differences between one-stage and two-stage cluster sampling.</figcaption><p></p>
</figure>
</div>
<section id="unbiased-estimator-of-population-total." class="level2">
<h2 class="anchored" data-anchor-id="unbiased-estimator-of-population-total.">Unbiased estimator of population total.</h2>
</section>
<section id="survey-weights" class="level2">
<h2 class="anchored" data-anchor-id="survey-weights">Survey weights</h2>
</section>
<section id="variance-estimation-for-two-stage-cluster-samples." class="level2">
<h2 class="anchored" data-anchor-id="variance-estimation-for-two-stage-cluster-samples.">Variance estimation for two-stage cluster samples.</h2>
<section id="simplified-version" class="level3">
<h3 class="anchored" data-anchor-id="simplified-version">Simplified version</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 5.7: More estimation of math scores.
</div>
</div>
<div class="callout-body-container callout-body">
<p>The file <code>schools.csv</code> contains data from a two-stage sample of students from hypothetical classes. The final weights are provided in the variable <code>finalwt</code>.</p>
<ol type="a">
<li>Create side by side boxplots for the math score for sampled schools. Which do you think is larger, the within or between cluster variance?</li>
<li>Create an ANOVA table for this example. Is your interpretation from the graph upheld by this analysis?</li>
<li>Estimate with proper 95% CI the average math score for the population of students under consideration. <em>Do not include a value for the <code>fpc</code> in this example</em>.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You Try It: The case of the six-legged puppy.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
</section>
</section>
<section id="chapter-summary" class="level1">
<h1>Chapter Summary</h1>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This site is built with <span class="emoji" data-emoji="heart">❤️</span>, <a href="https://posit.co/">R</a> and <a href="https://quarto.org/">Quarto</a> by <a href="www.norcalbiostat.com">Robin Donatello</a> and the Spring 2025 Math 458 class</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>